---
// Prerender this page (since we're using hybrid mode)
export const prerender = true;

import BaseLayout from '../layouts/BaseLayout.astro';
import HeroTailwind from '../components/HeroTailwind.astro';
import LocationsTailwind from '../components/LocationsTailwind.astro';
import AboutUsTailwind from '../components/AboutUsTailwind.astro';
import Section4Tailwind from '../components/Section4Tailwind.astro';
import JamieMurrayTailwind from '../components/JamieMurrayTailwind.astro';
import EventsTailwind from '../components/EventsTailwind.astro';
import OurPartnersTailwind from '../components/OurPartnersTailwind.astro';
import RacketHolidaySpecialistsTailwind from '../components/RacketHolidaySpecialistsTailwind.astro';
import ThrivingCommunityTailwind from '../components/ThrivingCommunityTailwind.astro';
import WhatDoWeOfferTailwind from '../components/WhatDoWeOfferTailwind.astro';
import StoriesOfHopeTailwind from '../components/StoriesOfHopeTailwind.astro';
import OurBlogTailwind from '../components/OurBlogTailwind.astro';
import InstagramTailwind from '../components/InstagramTailwind.astro';
import GalleryTailwind from '../components/GalleryTailwind.astro';
import HolidayExpertsTailwind from '../components/HolidayExpertsTailwind.astro';
import FooterTailwind from '../components/FooterTailwind.astro';
import { getHomeData, getHomePage } from '../utils/strapi.js';

// üöÄ SINGLE API CALL - Fetch all homepage data once
let homeData = null;
try {
  homeData = await getHomeData();
  console.log('üè† [index.astro] Home data fetched successfully (single API call)');
} catch (error) {
  console.warn('[index.astro] New fields not available yet, using basic home data:', error.message);
  // Fallback to basic home data until Strapi deploys new schema
  try {
    const basicData = await getHomePage();
    if (basicData) {
      homeData = {
        hero: {
          heading: basicData.main_heading,
          subHeading: basicData.main_sub_heading,
          headerImage: basicData.headerImage,
          testimonialImages: []
        }
      };
      console.log('‚úÖ [index.astro] Using basic home data as fallback');
    }
  } catch (fallbackError) {
    console.error('[index.astro] Both getHomeData and getHomePage failed:', fallbackError.message);
  }
}
---

<BaseLayout 
  title={homeData?.seo?.metaTitle || "Active Away - Exceptional Tennis, Padel & Pickleball Experiences"}
  description={homeData?.seo?.metaDescription || "Unique Racket Experiences that unite like-minded individuals, through impeccable service delivered by truly knowledgeable hosts in excellent locations."}
  metaTitle={homeData?.seo?.metaTitle}
  metaDescription={homeData?.seo?.metaDescription}
  metaImage={homeData?.seo?.metaImage?.url}
  keywords={homeData?.seo?.keywords}
  metaRobots={homeData?.seo?.metaRobots}
  canonicalURL={homeData?.seo?.canonicalURL || "https://activeaway.com"}
  ogTitle={homeData?.seo?.ogTitle}
  ogDescription={homeData?.seo?.ogDescription}
  ogImage={homeData?.seo?.ogImage?.url}
  ogUrl={homeData?.seo?.ogUrl || "https://activeaway.com"}
  ogType={homeData?.seo?.ogType}
  structuredData={homeData?.seo?.structuredData}
>
    <HeroTailwind homeData={homeData} />
  <LocationsTailwind />
  <AboutUsTailwind homeData={homeData} />
  <JamieMurrayTailwind homeData={homeData} />
  <EventsTailwind />
  <OurPartnersTailwind homeData={homeData} />
  <RacketHolidaySpecialistsTailwind homeData={homeData} />
  <ThrivingCommunityTailwind homeData={homeData} />
  <WhatDoWeOfferTailwind homeData={homeData} />
  <StoriesOfHopeTailwind homeData={homeData} />
  <OurBlogTailwind />
  <InstagramTailwind homeData={homeData} />
  <HolidayExpertsTailwind homeData={homeData} />
  <FooterTailwind />
</BaseLayout>
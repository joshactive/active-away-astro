---
// Prerender this page (since we're using hybrid mode)
export const prerender = true;

import BaseLayout from '../layouts/BaseLayout.astro';
import HeroTailwind from '../components/HeroTailwind.astro';
import LocationsTailwind from '../components/LocationsTailwind.astro';
import AboutUsTailwind from '../components/AboutUsTailwind.astro';
import Section4Tailwind from '../components/Section4Tailwind.astro';
import JamieMurrayTailwind from '../components/JamieMurrayTailwind.astro';
import EventsTailwind from '../components/EventsTailwind.astro';
import OurPartnersTailwind from '../components/OurPartnersTailwind.astro';
import RacketHolidaySpecialistsTailwind from '../components/RacketHolidaySpecialistsTailwind.astro';
import ThrivingCommunityTailwind from '../components/ThrivingCommunityTailwind.astro';
import WhatDoWeOfferTailwind from '../components/WhatDoWeOfferTailwind.astro';
import StoriesOfHopeTailwind from '../components/StoriesOfHopeTailwind.astro';
import OurBlogTailwind from '../components/OurBlogTailwind.astro';
import InstagramTailwind from '../components/InstagramTailwind.astro';
import GalleryTailwind from '../components/GalleryTailwind.astro';
import HolidayExpertsTailwind from '../components/HolidayExpertsTailwind.astro';
import FooterTailwind from '../components/FooterTailwind.astro';
import { getHomeData, getHomePage, getHomeSEO } from '../utils/strapi.js';

// üöÄ SINGLE API CALL - Fetch all homepage data once
let homeData = null;
try {
  homeData = await getHomeData();
  console.log('üè† [index.astro] Home data fetched successfully (single API call)');
} catch (error) {
  console.warn('[index.astro] New fields not available yet, using basic home data:', error.message);
  // Fallback to basic home data until Strapi deploys new schema
  try {
    const basicData = await getHomePage();
    if (basicData) {
      homeData = {
        hero: {
          heading: basicData.main_heading,
          subHeading: basicData.main_sub_heading,
          headerImage: basicData.headerImage,
          testimonialImages: []
        }
      };
      console.log('‚úÖ [index.astro] Using basic home data as fallback');
    }
  } catch (fallbackError) {
    console.error('[index.astro] Both getHomeData and getHomePage failed:', fallbackError.message);
  }
}

// üìÑ Fetch SEO data separately
let seoData = null;
try {
  seoData = await getHomeSEO();
  if (seoData) {
    console.log('üìÑ [index.astro] SEO data fetched successfully');
  }
} catch (error) {
  console.warn('[index.astro] Could not fetch SEO data:', error.message);
}

// Extract SEO fields with fallbacks
const pageTitle = seoData?.metaTitle || "Active Away - Exceptional Tennis, Padel & Pickleball Experiences";
const pageDescription = seoData?.metaDescription || "Unique Racket Experiences that unite like-minded individuals, through impeccable service delivered by truly knowledgeable hosts in excellent locations.";
const metaImage = seoData?.metaImage || null;
const metaImageAlt = seoData?.metaImageAlt || null;
const metaImageWidth = seoData?.metaImageWidth || null;
const metaImageHeight = seoData?.metaImageHeight || null;
const keywords = seoData?.keywords || null;
const canonicalURL = seoData?.canonicalURL || "https://activeaway.com/";
---

<BaseLayout 
  title={pageTitle}
  description={pageDescription}
  metaImage={metaImage}
  metaImageAlt={metaImageAlt}
  metaImageWidth={metaImageWidth}
  metaImageHeight={metaImageHeight}
  keywords={keywords}
  canonicalURL={canonicalURL}
>
    <HeroTailwind homeData={homeData} />
  <LocationsTailwind />
  <AboutUsTailwind homeData={homeData} />
  <JamieMurrayTailwind homeData={homeData} />
  <EventsTailwind />
  <OurPartnersTailwind homeData={homeData} />
  <RacketHolidaySpecialistsTailwind homeData={homeData} />
  <ThrivingCommunityTailwind homeData={homeData} />
  <WhatDoWeOfferTailwind homeData={homeData} />
  <StoriesOfHopeTailwind homeData={homeData} />
  <OurBlogTailwind />
  <InstagramTailwind homeData={homeData} />
  <HolidayExpertsTailwind homeData={homeData} />
  <FooterTailwind />
</BaseLayout>
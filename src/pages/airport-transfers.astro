---
// Airport Transfers Page
export const prerender = true;

import BaseLayout from '../layouts/BaseLayout.astro';
import PageHeroTailwind from '../components/PageHeroTailwind.astro';
import BreadcrumbsTailwind from '../components/BreadcrumbsTailwind.astro';
import { getAirportTransfersPage, getAirportTransfersPageSEO } from '../utils/strapi.js';
import { parseMarkdown } from '../utils/markdown.js';

// Fetch Airport Transfers page data
let pageData = null;
try {
  pageData = await getAirportTransfersPage();
  console.log('‚úàÔ∏è  [airport-transfers] Page data fetched');
} catch (error) {
  console.error('‚ùå [airport-transfers] Error fetching page:', error.message);
}

// Fetch SEO data
let seoData = null;
try {
  seoData = await getAirportTransfersPageSEO();
  if (seoData) {
    console.log('üìÑ [airport-transfers] SEO data fetched');
  }
} catch (error) {
  console.warn('‚ö†Ô∏è  [airport-transfers] Could not fetch SEO data:', error.message);
}

// Extract SEO fields
const pageTitle = seoData?.metaTitle || pageData?.seo?.metaTitle || 'Airport Transfers | Active Away';
const pageDescription = seoData?.metaDescription || pageData?.seo?.metaDescription || 'Book reliable airport transfers for your tennis holiday with Active Away. Professional drivers and comfortable vehicles.';

// Extract meta image URL properly
let metaImage = null;
if (seoData?.metaImage) {
  metaImage = typeof seoData.metaImage === 'string' ? seoData.metaImage : seoData.metaImage.url;
} else if (pageData?.seo?.metaImage) {
  metaImage = typeof pageData.seo.metaImage === 'string' ? pageData.seo.metaImage : pageData.seo.metaImage.url;
}

const metaImageAlt = seoData?.metaImageAlt || pageData?.seo?.metaImageAlt || null;
const metaImageWidth = seoData?.metaImageWidth || pageData?.seo?.metaImageWidth || null;
const metaImageHeight = seoData?.metaImageHeight || pageData?.seo?.metaImageHeight || null;
const keywords = seoData?.keywords || pageData?.seo?.keywords || null;
const canonicalURL = seoData?.canonicalURL || pageData?.seo?.canonicalURL || 'https://activeaway.com/airport-transfers';

// Parse markdown content
const importantContent = pageData?.importantContent ? parseMarkdown(pageData.importantContent) : '';
---

<BaseLayout 
  title={pageTitle}
  description={pageDescription}
  metaImage={metaImage}
  metaImageAlt={metaImageAlt}
  metaImageWidth={metaImageWidth}
  metaImageHeight={metaImageHeight}
  keywords={keywords}
  canonicalURL={canonicalURL}
>
  <!-- Page Hero (Background Image) -->
  {pageData?.pageHero && (
    <PageHeroTailwind pageData={pageData} />
  )}
  
  <!-- Breadcrumbs Section -->
  {pageData?.pageHero?.showBreadcrumbs !== false && (
    <BreadcrumbsTailwind 
      breadcrumbs={[
        { label: 'Home', href: '/' },
        { label: 'Airport Transfers' }
      ]}
    />
  )}
  
  <!-- Main Content -->
  <main class="w-full bg-white py-12 sm:py-16 lg:py-20">
    <div class="container mx-auto max-w-[1400px] px-4 sm:px-10">
      
      <!-- Important Notice -->
      {importantContent && (
        <div class="mb-12 bg-gray-50 border border-gray-200 rounded-xl p-6 sm:p-8">
          <p class="text-xs font-inter font-semibold text-[#ad986c] tracking-wider uppercase mb-3">
            {pageData.importantEyebrow || 'IMPORTANT'}
          </p>
          <div class="prose prose-lg max-w-none font-inter" set:html={importantContent}></div>
        </div>
      )}

      <!-- Table of Contents -->
      {pageData?.showContents && pageData?.contentsItems && pageData.contentsItems.length > 0 && (
        <div class="mb-12 bg-white border-2 border-gray-200 rounded-xl p-6 sm:p-8 shadow-sm">
          <h2 class="text-2xl font-playfair font-bold text-gray-900 mb-6">Contents</h2>
          <nav class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            {pageData.contentsItems.map((item) => (
              <a 
                href={`#${item.anchor}`} 
                class="flex items-center gap-2 text-base font-inter text-gray-700 hover:text-[#ad986c] transition-colors py-2 px-3 rounded-lg hover:bg-gray-50"
              >
                <svg class="w-4 h-4 flex-shrink-0 text-[#ad986c]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
                {item.label}
              </a>
            ))}
          </nav>
        </div>
      )}

      <!-- Key Information Section -->
      {pageData?.keyInfoAccordions && pageData.keyInfoAccordions.length > 0 && (
        <section id="key-information" class="mb-12 scroll-mt-20">
          <h2 class="text-2xl sm:text-3xl lg:text-4xl font-playfair font-semibold text-gray-900 mb-4 text-center">
            {pageData.keyInfoTitle || 'Key Information'}
          </h2>
          {pageData.keyInfoSubtitle && (
            <p class="text-base sm:text-lg font-inter text-gray-600 text-center mb-8 sm:mb-12 max-w-3xl mx-auto">
              {pageData.keyInfoSubtitle}
            </p>
          )}

          <!-- Accordions Container (2-column grid on lg) -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 lg:gap-8">
            {pageData.keyInfoAccordions.map((accordion, index) => {
              const parsedContent = accordion.content ? parseMarkdown(accordion.content) : '';
              return (
                <div 
                  class="accordion bg-white border border-gray-200 rounded-xl overflow-hidden transition-all duration-300 shadow-sm hover:shadow-md"
                  data-accordion-index={index}
                >
                  <button
                    type="button" 
                    class="accordion-header flex items-center justify-between p-4 sm:p-6 w-full text-left cursor-pointer hover:bg-gray-50 transition-colors"
                  >
                    <h3 class="text-base lg:text-lg font-inter font-medium text-gray-900 pr-4">
                      {accordion.title}
                    </h3>
                    <div class="expand-icon flex-shrink-0">
                      <div class="arrow-icon w-6 h-6 flex items-center justify-center transition-transform duration-300">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                          <path d="M4 6L8 10L12 6" stroke="#1E1E1E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </div>
                    </div>
                  </button>
                  <div class="accordion-content overflow-hidden transition-all duration-300" style="max-height: 0; opacity: 0;">
                    <div class="px-4 pb-4 sm:px-6 sm:pb-6 pt-0">
                      <div class="prose prose-lg max-w-none font-inter" set:html={parsedContent} />
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </section>
      )}

      <!-- Pricing Section -->
      {pageData?.pricingTable && pageData.pricingTable.length > 0 && (
        <section id="pricing" class="scroll-mt-20">
          <h2 class="text-2xl sm:text-3xl lg:text-4xl font-playfair font-semibold text-gray-900 mb-4 text-center">
            {pageData.pricingTitle || 'Pricing'}
          </h2>
          {pageData.pricingSubtitle && (
            <p class="text-base sm:text-lg font-inter text-gray-600 text-center mb-8 sm:mb-12 max-w-3xl mx-auto">
              {pageData.pricingSubtitle}
            </p>
          )}

          <!-- Pricing Table -->
          <div class="max-w-4xl mx-auto space-y-3">
            {pageData.pricingTable.map((row, index) => (
              <div class="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                <div class="p-6">
                  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div class="flex-1">
                      <div class="flex items-center gap-4 mb-2">
                        <div class="hidden sm:flex w-12 h-12 bg-[#ad986c] text-white rounded-full items-center justify-center font-bold font-playfair text-base flex-shrink-0">
                          {index + 1}
                        </div>
                        <h3 class="text-base lg:text-lg font-inter font-medium text-gray-900">
                          {row.route}
                        </h3>
                      </div>
                      {row.notes && (
                        <p class="text-sm font-inter text-gray-600 sm:ml-16">
                          {row.notes}
                        </p>
                      )}
                    </div>
                    <div class="flex-shrink-0">
                      <p class="text-2xl sm:text-3xl font-playfair font-bold text-[#ad986c]">
                        {row.price}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </section>
      )}
      
    </div>
  </main>
</BaseLayout>

<style>
  .font-inter {
    font-family: 'Inter', sans-serif;
  }
  
  .font-playfair {
    font-family: 'Playfair Display', serif;
  }

  /* Prose Styles - Using :global() to properly target markdown content */
  :global(.prose p) {
    margin: 0 0 1.5rem 0;
    line-height: 1.75;
    font-size: 1rem;
  }
  
  @media (min-width: 640px) {
    :global(.prose p) {
      font-size: 1.125rem;
    }
  }
  
  :global(.prose p:last-child) {
    margin-bottom: 0;
  }
  
  :global(.prose h1),
  :global(.prose h2),
  :global(.prose h3),
  :global(.prose h4),
  :global(.prose h5),
  :global(.prose h6) {
    font-family: 'Playfair Display', serif !important;
    color: rgb(17 24 39) !important;
    font-weight: 600 !important;
    font-style: normal !important;
    letter-spacing: normal !important;
    text-transform: none !important;
  }
  
  :global(.prose h1) {
    font-size: 2.25rem !important;
    margin-top: 0 !important;
    margin-bottom: 2rem !important;
    line-height: 1.2 !important;
  }
  
  :global(.prose h2) {
    font-size: 1.875rem !important;
    margin-top: 3rem !important;
    margin-bottom: 1.5rem !important;
    line-height: 1.3 !important;
  }
  
  :global(.prose h3) {
    font-size: 1.5rem !important;
    margin-top: 2rem !important;
    margin-bottom: 1rem !important;
    line-height: 1.4 !important;
  }
  
  :global(.prose h4) {
    font-size: 1.25rem !important;
    margin-top: 1.5rem !important;
    margin-bottom: 0.75rem !important;
  }
  
  @media (min-width: 640px) {
    :global(.prose h1) {
      font-size: 2.5rem !important;
    }
    
    :global(.prose h2) {
      font-size: 2rem !important;
    }
    
    :global(.prose h3) {
      font-size: 1.625rem !important;
    }
  }
  
  @media (min-width: 1024px) {
    :global(.prose h1) {
      font-size: 3rem !important;
    }
    
    :global(.prose h2) {
      font-size: 2.25rem !important;
    }
    
    :global(.prose h3) {
      font-size: 1.75rem !important;
    }
  }
  
  :global(.prose ul),
  :global(.prose ol) {
    margin-top: 1rem;
    margin-bottom: 1.5rem;
    padding-left: 1.75rem;
  }
  
  :global(.prose li) {
    margin-bottom: 0.5rem;
  }
  
  :global(.prose strong) {
    font-weight: 600;
    color: rgb(17 24 39);
  }
  
  :global(.prose a) {
    color: #ad986c;
    text-decoration: underline;
  }
  
  :global(.prose a:hover) {
    color: #8a7454;
  }
  
  :global(.prose blockquote) {
    border-left: 4px solid #ad986c;
    padding-left: 1.5rem;
    font-style: italic;
    color: rgb(75 85 99);
    margin: 2rem 0;
  }
</style>

<script>
  // Accordion functionality
  document.addEventListener('DOMContentLoaded', () => {
    const accordionHeaders = document.querySelectorAll('.accordion-header');
    
    accordionHeaders.forEach((header) => {
      header.addEventListener('click', () => {
        const accordion = header.closest('.accordion');
        if (!accordion) return;
        
        const content = accordion.querySelector('.accordion-content');
        const arrow = accordion.querySelector('.arrow-icon');
        const isOpen = accordion.classList.contains('open');
        
        // Toggle current accordion
        if (isOpen) {
          accordion.classList.remove('open', 'shadow-lg');
          accordion.classList.add('shadow-sm');
          if (content) {
            content.style.maxHeight = '0';
            content.style.opacity = '0';
          }
          if (arrow) {
            arrow.classList.remove('rotate-180');
          }
        } else {
          // Close other accordions in the same parent
          const parent = accordion.parentElement;
          if (parent) {
            const siblings = parent.querySelectorAll('.accordion');
            siblings.forEach(acc => {
              if (acc !== accordion) {
                acc.classList.remove('open', 'shadow-lg');
                acc.classList.add('shadow-sm');
                const accContent = acc.querySelector('.accordion-content');
                const accArrow = acc.querySelector('.arrow-icon');
                if (accContent) {
                  accContent.style.maxHeight = '0';
                  accContent.style.opacity = '0';
                }
                if (accArrow) {
                  accArrow.classList.remove('rotate-180');
                }
              }
            });
          }
          
          accordion.classList.add('open', 'shadow-lg');
          accordion.classList.remove('shadow-sm');
          if (content) {
            content.style.maxHeight = content.scrollHeight + 'px';
            content.style.opacity = '1';
          }
          if (arrow) {
            arrow.classList.add('rotate-180');
          }
        }
      });
    });
  });
</script>


---
// Terms and Conditions Page
export const prerender = true;

import BaseLayout from '../layouts/BaseLayout.astro';
import { getTermsPage, getPageSEO } from '../utils/strapi.js';
import { marked } from 'marked';

// Configure marked
marked.setOptions({
  breaks: true,
  gfm: true
});

// Fetch page content from Strapi
let pageContent = null;
try {
  pageContent = await getTermsPage();
  console.log('ðŸ“„ [terms] Page content fetched successfully');
} catch (error) {
  console.warn('[terms] Could not fetch page content, using defaults:', error.message);
}

// Fetch SEO data separately
let seoData = null;
try {
  seoData = await getPageSEO('terms-page');
  if (seoData) {
    console.log('ðŸ“„ [terms] SEO data fetched successfully');
  }
} catch (error) {
  console.warn('[terms] Could not fetch SEO data:', error.message);
}

// Extract data with fallbacks
const pageTitle = pageContent?.pageTitle || 'Booking Terms & Conditions';
const content = pageContent?.content || '';
const lastUpdated = pageContent?.lastUpdated || null;

// Extract SEO fields
const metaTitle = seoData?.metaTitle || pageContent?.seo?.metaTitle || 'Terms & Conditions | Active Away';
const metaDescription = seoData?.metaDescription || pageContent?.seo?.metaDescription || 'Read our booking terms and conditions for Active Away tennis, padel, pickleball, and ski holidays.';
const metaImage = seoData?.metaImage || pageContent?.seo?.metaImage || null;
const metaImageAlt = seoData?.metaImageAlt || pageContent?.seo?.metaImageAlt || null;
const metaImageWidth = seoData?.metaImageWidth || null;
const metaImageHeight = seoData?.metaImageHeight || null;
const keywords = seoData?.keywords || pageContent?.seo?.keywords || null;
const canonicalURL = seoData?.canonicalURL || pageContent?.seo?.canonicalURL || 'https://activeaway.com/booking-terms-conditions';

// Hero content
const heroBackgroundImage = 'https://activeaway.com/cdn-cgi/imagedelivery/-aT8Z2F9gGvZ9fdofZcCaQ/45b69090-1c22-46cd-7f98-086ba71efc00/public';
---

<BaseLayout 
  title={metaTitle}
  description={metaDescription}
  metaImage={metaImage}
  metaImageAlt={metaImageAlt}
  metaImageWidth={metaImageWidth}
  metaImageHeight={metaImageHeight}
  keywords={keywords}
  canonicalURL={canonicalURL}
>
  <!-- Hero Header Section -->
  <section class="relative w-full h-[300px] sm:h-[350px] lg:h-[400px] overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-b from-[#0D1C4E]/75 via-[#0D1C4E]/60 to-[#0D1C4E]/60 z-10"></div>
    <img 
      src={heroBackgroundImage}
      alt="Terms and Conditions"
      class="absolute inset-0 w-full h-full object-cover"
      loading="eager"
    />
    
    <div class="relative z-20 container mx-auto max-w-[1400px] px-4 sm:px-10 h-full flex flex-col justify-center items-center text-center">
      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-playfair font-bold text-white mb-4 leading-tight max-w-4xl">
        {pageTitle}
      </h1>
      {lastUpdated && (
        <p class="text-base sm:text-lg font-inter text-gray-100">
          Last updated: {new Date(lastUpdated).toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}
        </p>
      )}
    </div>
  </section>

  <!-- Breadcrumb Navigation -->
  <section class="w-full bg-gray-50 py-4 border-b border-gray-200">
    <div class="container mx-auto max-w-[1400px] px-4 sm:px-10">
      <nav class="flex items-center space-x-2 text-sm font-inter">
        <a href="/" class="text-gray-600 hover:text-[#ad986c] transition-colors">Home</a>
        <svg class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <span class="text-gray-900 font-medium">{pageTitle}</span>
      </nav>
    </div>
  </section>

  <!-- Main Content -->
  <main class="w-full bg-white py-12 sm:py-16 lg:py-20">
    <div class="container mx-auto max-w-4xl px-4 sm:px-10">
      <!-- Terms Content -->
      <div class="prose prose-lg max-w-none font-inter">
        <div set:html={marked.parse(content || '')}></div>
      </div>
    </div>
  </main>
</BaseLayout>

<style>
  .prose {
    color: #1f2937;
  }

  .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
    font-family: 'Playfair Display', serif;
    font-weight: 600;
    color: #111827;
    margin-top: 2em;
    margin-bottom: 1em;
  }

  .prose h2 {
    font-size: 2em;
    border-bottom: 2px solid #ad986c;
    padding-bottom: 0.5em;
  }

  .prose h3 {
    font-size: 1.5em;
  }

  .prose h4 {
    font-size: 1.25em;
  }

  .prose h5 {
    font-size: 1.125em;
    color: #ad986c;
  }

  .prose p {
    margin-bottom: 1.25em;
    line-height: 1.75;
  }

  .prose ul, .prose ol {
    margin-left: 1.5em;
    margin-bottom: 1.25em;
  }

  .prose li {
    margin-bottom: 0.5em;
  }

  .prose strong {
    color: #111827;
    font-weight: 600;
  }

  .prose a {
    color: #ad986c;
    text-decoration: underline;
  }

  .prose a:hover {
    color: #8d7a56;
  }
</style>


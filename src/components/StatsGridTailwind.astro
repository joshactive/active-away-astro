---
// Stats Grid section component - Tailwind CSS Version

interface StatItem {
  number: string;
  label: string;
}

interface Props {
  aboutData?: any;
  stats?: StatItem[];
  backgroundClass?: string;
  numberColorClass?: string;
  labelColorClass?: string;
}

const {
  aboutData,
  stats,
  backgroundClass = 'bg-gray-50',
  numberColorClass = 'text-[#ad986c]',
  labelColorClass = 'text-gray-700'
} = Astro.props;

const statsData: StatItem[] = Array.isArray(stats) && stats.length > 0
  ? stats
  : (aboutData?.stats?.stats || []);

const hasStats = statsData.length > 0;
const componentId = `stats-grid-${Math.random().toString(36).slice(2, 9)}`;
---

{hasStats && (
  <section 
    class={`w-full ${backgroundClass} py-12 sm:py-16 lg:py-20`}
    data-stats-grid-id={componentId}
  >
    <div class="container mx-auto max-w-[1400px] px-4 sm:px-10">
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-6 sm:gap-8 lg:gap-12">
        {statsData.map((stat, index) => (
          <div class="text-center">
            <div 
              class={`stat-number text-4xl sm:text-5xl lg:text-6xl font-playfair font-bold mb-2 ${numberColorClass}`}
              data-target={stat.number}
              data-index={index}
            >
              0
            </div>
            <div class={`text-sm sm:text-base lg:text-lg font-inter font-medium ${labelColorClass}`}>
              {stat.label}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
)}

<style>
  .font-inter {
    font-family: 'Inter', sans-serif;
  }
  
  .font-playfair {
    font-family: 'Playfair Display', serif;
  }
</style>

<script define:vars={{ statsGridId: componentId }}>
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.querySelector(`[data-stats-grid-id="${statsGridId}"]`);
    if (!section) return;
    
    const statNumbers = section.querySelectorAll('.stat-number');
    if (statNumbers.length === 0) {
      return;
    }
    
    let hasAnimated = false;
    
    function extractNumber(str) {
      const cleaned = str.replace(/[,+]/g, '');
      return parseInt(cleaned) || 0;
    }
    
    function animateStat(element, targetStr) {
      const suffix = targetStr.trim().endsWith('+') ? '+' : '';
      const hasComma = targetStr.includes(',');
      const target = extractNumber(targetStr);
      const duration = 2000;
      const fps = 60;
      const totalFrames = (duration / 1000) * fps;
      const increment = target / totalFrames;
      
      let current = 0;
      let frame = 0;
      
      const timer = setInterval(() => {
        frame++;
        current += increment;
        
        if (frame >= totalFrames) {
          current = target;
          clearInterval(timer);
        }
        
        let displayNum = Math.floor(current);
        if (hasComma && displayNum >= 1000) {
          displayNum = displayNum.toLocaleString();
        }
        element.textContent = displayNum + suffix;
      }, 1000 / fps);
    }
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting && !hasAnimated) {
          hasAnimated = true;
          statNumbers.forEach((stat) => {
            const target = stat.getAttribute('data-target');
            if (target) {
              animateStat(stat, target);
            }
          });
        }
      });
    }, {
      threshold: 0.3
    });
    
    observer.observe(section);
  });
</script>


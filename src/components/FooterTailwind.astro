---
// Footer component - Tailwind CSS Version - Fixed to match Figma
import { getImageByName } from '../utils/cloudflareImages.js';
import { FooterArrow } from '../components/ui/FooterIcons';

// Get dynamic image URLs
const footerLogo = 'https://activeaway.com/cdn-cgi/imagedelivery/-aT8Z2F9gGvZ9fdofZcCaQ/4a4fae2f-b29c-4e69-5a9e-acf953fd3c00/public';
const footerProtection1 = getImageByName('footer-protection-1', { size: 'public' });
const footerProtection2 = getImageByName('footer-protection-2', { size: 'public' });

// Debug: Log the URLs being generated
console.log('Footer Images URLs:', { 
  footerLogo, footerProtection1, footerProtection2
});
---

<section class="w-full bg-gray-900 py-12 sm:py-16 lg:py-24">
  <div class="container mx-auto px-4 sm:px-10">
    <!-- Main Footer Content -->
    <div class="grid grid-cols-1 lg:grid-cols-[2fr_1fr_1fr_1fr_1fr] gap-8 sm:gap-6 lg:gap-8 mb-6 sm:mb-8">
      <!-- Column 1: Logo and Contact -->
      <div class="order-1">
        <div class="mb-4 sm:mb-6">
          <img src={footerLogo} alt="Active Away Logo" width="200" height="56" class="h-14 sm:h-18 lg:h-20 w-auto" />
        </div>
        
        <div>
          <h3 class="text-sm sm:text-base font-inter font-semibold text-white mb-3 sm:mb-4">Contact</h3>
          
          <div class="space-y-2 sm:space-y-3 mb-6 sm:mb-8">
            <div class="flex items-start gap-2">
              <svg class="w-4 h-4 text-gold flex-shrink-0 mt-0.5" viewBox="0 0 14 14" fill="none">
                <path d="M7 1.5C4.5 1.5 2.5 3.5 2.5 6C2.5 7.5 3.5 8.5 4.5 9.5L7 12L9.5 9.5C10.5 8.5 11.5 7.5 11.5 6C11.5 3.5 9.5 1.5 7 1.5Z" stroke="#AD986C" stroke-width="1"/>
                <path d="M7 4C6.2 4 5.5 4.7 5.5 5.5C5.5 6.3 6.2 7 7 7C7.8 7 8.5 6.3 8.5 5.5C8.5 4.7 7.8 4 7 4Z" stroke="#AD986C" stroke-width="1"/>
              </svg>
              <span class="text-xs sm:text-sm font-inter text-gray-300">Palliser House, Palliser Road, London W14 9EQ</span>
            </div>
            
            <a href="tel:+442079657277" class="flex items-center gap-2 text-gray-300 hover:text-[#ad986c] transition-colors group">
              <svg class="w-4 h-4 text-gold flex-shrink-0" viewBox="0 0 14 14" fill="none">
                <path d="M3.5 2C2.7 2 2 2.7 2 3.5V10.5C2 11.3 2.7 12 3.5 12H10.5C11.3 12 12 11.3 12 10.5V3.5C12 2.7 11.3 2 10.5 2H3.5Z" stroke="#AD986C" stroke-width="1"/>
                <path d="M7 7C7 7 7.5 6.5 7.5 6C7.5 5.5 7 5 7 5C7 5 6.5 5.5 6.5 6C6.5 6.5 7 7 7 7Z" stroke="#AD986C" stroke-width="1"/>
              </svg>
              <span class="text-xs sm:text-sm font-inter">+44 20 7965 7277</span>
            </a>
            
            <a href="mailto:hello@activeaway.com" class="flex items-center gap-2 text-gray-300 hover:text-[#ad986c] transition-colors group">
              <svg class="w-4 h-4 text-gold flex-shrink-0" viewBox="0 0 14 14" fill="none">
                <path d="M2 4C2 3.4 2.4 3 3 3H11C11.6 3 12 3.4 12 4V10C12 10.6 11.6 11 11 11H3C2.4 11 2 10.6 2 10V4Z" stroke="#AD986C" stroke-width="1"/>
                <path d="M2 4L7 7L12 4" stroke="#AD986C" stroke-width="1"/>
              </svg>
              <span class="text-xs sm:text-sm font-inter">hello@activeaway.com</span>
            </a>
          </div>
        </div>
        
        <div class="flex items-center gap-3">
          <!-- Facebook -->
          <a href="https://facebook.com/activeaway" target="_blank" rel="noopener noreferrer" class="w-8 h-8 bg-transparent border border-gold/30 rounded-lg flex items-center justify-center hover:bg-gold/10 transition-colors">
            <svg class="w-4 h-4 text-gold" viewBox="0 0 24 24" fill="currentColor">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </a>
          <!-- Instagram -->
          <a href="https://www.instagram.com/active.away/" target="_blank" rel="noopener noreferrer" class="w-8 h-8 bg-transparent border border-gold/30 rounded-lg flex items-center justify-center hover:bg-gold/10 transition-colors">
            <svg class="w-4 h-4 text-gold" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
              <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
              <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
            </svg>
          </a>
          <!-- Twitter -->
          <a href="http://twitter.com/activeaway" target="_blank" rel="noopener noreferrer" class="w-8 h-8 bg-transparent border border-gold/30 rounded-lg flex items-center justify-center hover:bg-gold/10 transition-colors">
            <svg class="w-4 h-4 text-gold" viewBox="0 0 24 24" fill="currentColor">
              <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
          </a>
          <!-- LinkedIn -->
          <a href="https://www.linkedin.com/company/2596498/" target="_blank" rel="noopener noreferrer" class="w-8 h-8 bg-transparent border border-gold/30 rounded-lg flex items-center justify-center hover:bg-gold/10 transition-colors">
            <svg class="w-4 h-4 text-gold" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Columns 2 & 3: Quick Links + Booking Information (side by side on mobile) -->
      <div class="order-2 col-span-1 lg:col-span-2 grid grid-cols-2 gap-6 lg:gap-8">
        <!-- Column 2: Quick Links -->
        <div>
          <h3 class="text-sm sm:text-base font-inter font-semibold text-white mb-3 sm:mb-4">Quick Links</h3>
          <div class="space-y-2 sm:space-y-3">
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Home</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Dates</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Rackets</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>About Us</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Destination</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Blogs</span>
            </a>
          </div>
        </div>
        
        <!-- Column 3: Booking Information -->
        <div>
          <h3 class="text-sm sm:text-base font-inter font-semibold text-white mb-3 sm:mb-4">Booking information</h3>
          <div class="space-y-2 sm:space-y-3">
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Terms & Conditions</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>FAQs</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>The Booking Process</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>View All Dates</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Airport Transfers</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Flight</span>
            </a>
            <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
              <FooterArrow client:load className="w-3 h-3 text-gold" />
              <span>Self Rating Guide</span>
            </a>
          </div>
        </div>
      </div>
      
      <!-- Column 4: Booking Protection -->
      <div class="order-3">
        <h3 class="text-sm sm:text-base font-inter font-semibold text-white mb-3 sm:mb-4">Booking Protection</h3>
        <div class="space-y-2 sm:space-y-3">
          <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
            <FooterArrow client:load className="w-3 h-3 text-gold" />
            <span>Travel Trust Association</span>
          </a>
          <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
            <FooterArrow client:load className="w-3 h-3 text-gold" />
            <span>Package Travel Regulations</span>
          </a>
          <a href="#" class="flex items-center gap-2 text-xs sm:text-sm font-inter text-gray-300 hover:text-gold transition-colors">
            <FooterArrow client:load className="w-3 h-3 text-gold" />
            <span>ATOL</span>
          </a>
        </div>
      </div>
      
      <!-- Column 5: Newsletter -->
      <div class="order-4">
        <h3 class="text-sm sm:text-base font-inter font-semibold text-white mb-3 sm:mb-4">Newsletter</h3>
        <form id="newsletter-form" class="space-y-3">
          <input 
            type="text" 
            id="newsletter-name"
            name="name"
            placeholder="Full Name" 
            required
            class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-xs sm:text-sm text-white placeholder-gray-400 focus:outline-none focus:border-gold transition-colors" 
          />
          <input 
            type="email" 
            id="newsletter-email"
            name="email"
            placeholder="Email Address" 
            required
            class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-xs sm:text-sm text-white placeholder-gray-400 focus:outline-none focus:border-gold transition-colors" 
          />
          
          <!-- Cloudflare Turnstile (only show if configured) -->
          {import.meta.env.PUBLIC_TURNSTILE_SITE_KEY && (
            <div class="cf-turnstile" data-sitekey={import.meta.env.PUBLIC_TURNSTILE_SITE_KEY} data-theme="dark"></div>
          )}
          
          <button 
            type="submit"
            id="newsletter-submit"
            class="w-full px-4 py-2 bg-gold hover:bg-gold-700 text-white text-xs sm:text-sm font-inter font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span id="newsletter-button-text">Submit</span>
          </button>
          <p id="newsletter-message" class="text-xs sm:text-sm font-inter text-center hidden"></p>
        </form>
      </div>
    </div>

    <!-- Bottom Section - Responsive 3-Column Layout -->
    <div class="border-t border-gray-800 pt-6 pb-1">
      <div class="flex flex-col lg:flex-row items-center lg:justify-between gap-6 sm:gap-8">
        <!-- Copyright (Left on Desktop, Bottom on Mobile) -->
        <div class="text-center lg:text-left order-3 lg:order-1">
          <p class="text-xs sm:text-sm font-inter text-gray-400">
            © <span id="copyright-year">{new Date().getFullYear()}</span> Active Away. All rights reserved
          </p>
        </div>
        
        <!-- Protection Badges (Center on Desktop, Middle on Mobile) -->
        <div class="flex justify-center items-center gap-4 order-2">
          <img src={footerProtection1} alt="ATOL Protected" width="100" height="56" class="h-12 sm:h-14 w-auto" />
          <img src={footerProtection2} alt="Financial Protection" width="100" height="56" class="h-12 sm:h-14 w-auto" />
        </div>
        
        <!-- Trustpilot Widget (Right on Desktop, Top on Mobile) -->
        <div class="flex items-center gap-2 order-1 lg:order-3">
          <div class="trustpilot-widget" data-locale="en-GB" data-template-id="5419b6a8b0d04a076446a9ad" data-businessunit-id="5fdb351da3a2b60001ac34ba" data-style-height="24px" data-style-width="100%" data-theme="dark" data-token="ca9d8ad1-cc16-49ab-a0e8-b1baa3dd973b" data-min-review-count="0" data-style-alignment="center">
            <a href="https://uk.trustpilot.com/review/activeaway.com" target="_blank" rel="noopener">Trustpilot</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .font-inter {
    font-family: 'Inter', sans-serif;
  }
</style>

<script>
  // Newsletter form submission
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('newsletter-form');
    const submitButton = document.getElementById('newsletter-submit');
    const buttonText = document.getElementById('newsletter-button-text');
    const message = document.getElementById('newsletter-message');
    const nameInput = document.getElementById('newsletter-name');
    const emailInput = document.getElementById('newsletter-email');

    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Get form data
      const name = nameInput.value.trim();
      const email = emailInput.value.trim();

      // Basic validation
      if (!name || !email) {
        message.textContent = 'Please fill in all fields';
        message.classList.remove('hidden', 'text-green-400');
        message.classList.add('text-red-400');
        return;
      }

      // Get Turnstile token - but allow submission without it in development
      let turnstileResponse = null;
      try {
        // Try to get Turnstile response if available
        if (typeof window.turnstile !== 'undefined' && window.turnstile) {
          turnstileResponse = window.turnstile.getResponse();
        }
      } catch (err) {
        console.warn('Turnstile not available:', err);
      }

      // Disable button and show loading
      submitButton.disabled = true;
      buttonText.textContent = 'Submitting...';
      message.classList.add('hidden');

      try {
        // Prepare the payload
        const payload = { 
          name, 
          email,
          turnstileToken: turnstileResponse
        };
        
        console.log('📤 Submitting newsletter form:', payload);
        
        const response = await fetch('/api/newsletter-signup.json', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload)
        });

        console.log('📥 Response status:', response.status);
        console.log('📥 Response headers:', Object.fromEntries(response.headers.entries()));
        
        const data = await response.json();
        console.log('📦 Response data:', data);

        if (response.ok) {
          // Success
          message.textContent = data.message || 'Thank you for subscribing!';
          message.classList.remove('hidden', 'text-red-400');
          message.classList.add('text-green-400');
          
          // Clear form
          form.reset();
          
          // Reset Turnstile if available
          try {
            if (typeof window.turnstile !== 'undefined' && window.turnstile) {
              window.turnstile.reset();
            }
          } catch (err) {
            console.warn('Could not reset Turnstile:', err);
          }
          
          // Reset button after 3 seconds
          setTimeout(() => {
            buttonText.textContent = 'Submit';
            submitButton.disabled = false;
            message.classList.add('hidden');
          }, 3000);
        } else {
          // Error
          throw new Error(data.error || 'Something went wrong');
        }
      } catch (error) {
        console.error('❌ Newsletter signup error:', error);
        
        // Show error message
        message.textContent = error.message || 'Failed to subscribe. Please try again.';
        message.classList.remove('hidden', 'text-green-400');
        message.classList.add('text-red-400');
        
        // Reset Turnstile on error if available
        try {
          if (typeof window.turnstile !== 'undefined' && window.turnstile) {
            window.turnstile.reset();
          }
        } catch (err) {
          console.warn('Could not reset Turnstile:', err);
        }
        
        // Re-enable button
        buttonText.textContent = 'Submit';
        submitButton.disabled = false;
      }
    });
  });
</script>

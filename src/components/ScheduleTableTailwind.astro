---
// Schedule/Itinerary Table component for Active Away product pages - Tailwind CSS Version
import { parseMarkdown } from '../utils/markdown.js';

interface Props {
  productData?: any;
}

const { productData } = Astro.props;

// Check if we are on a clinic page
const isClinicPage = Astro.url.pathname.includes('clinic');
const isJuniorCamp = Astro.url.pathname.includes('junior-tennis-camps');
const isReducedColumns = isClinicPage || isJuniorCamp;

// Extract schedule data with fallbacks
const scheduleData = {
  heading: productData?.schedule?.heading || '',
  scheduleRows: (productData?.schedule?.scheduleRows || []).map(row => ({
    day: row.day,
    morning: row.morning ? parseMarkdown(row.morning) : null,
    afternoon: row.afternoon ? parseMarkdown(row.afternoon) : null,
    evening: row.evening ? parseMarkdown(row.evening) : null
  }))
};

// If no schedule rows, don't render the component
const hasSchedule = scheduleData.scheduleRows && scheduleData.scheduleRows.length > 0;
---

{hasSchedule && (
  <section class="w-full bg-gray-50 py-12 sm:py-16 lg:py-24">
    <div class="container mx-auto max-w-[1400px] px-4 sm:px-10">
      {scheduleData.heading && (
        <h2 class="text-2xl sm:text-3xl lg:text-4xl font-playfair font-semibold text-gray-900 mb-8 sm:mb-12 text-center">
          {scheduleData.heading}
        </h2>
      )}
      
      <!-- Mobile: Accordion Layout -->
      <div class="block lg:hidden space-y-4">
        {scheduleData.scheduleRows.map((row, index) => (
          <div class="bg-white border-2 border-gray-200 rounded-xl overflow-hidden shadow-sm schedule-accordion-item">
            {/* Day Header - Clickable */}
            <button 
              type="button"
              class="schedule-accordion-btn w-full bg-[#0D1C4E] text-white px-4 py-3 flex items-center justify-between"
              data-schedule-index={index}
            >
              <h3 class="text-lg font-inter font-semibold">{row.day}</h3>
              <svg 
                class="schedule-chevron w-5 h-5 transition-transform duration-300"
                viewBox="0 0 24 24" 
                fill="none"
              >
                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            
            {/* Schedule Details - Collapsible */}
            <div class="schedule-accordion-content max-h-0 overflow-hidden transition-all duration-300 ease-in-out">
              <div class="divide-y divide-gray-200">
                {row.morning && (
                  <div class="p-4">
                    <h4 class="text-sm font-inter font-semibold text-gray-900 mb-2 uppercase tracking-wide">{isClinicPage ? 'Content' : (isJuniorCamp ? 'Schedule' : 'Morning')}</h4>
                    <div class="text-base sm:text-lg font-inter text-gray-700 leading-relaxed prose max-w-none">
                      <Fragment set:html={row.morning} />
                    </div>
                  </div>
                )}
                
                {!isReducedColumns && row.afternoon && (
                  <div class="p-4">
                    <h4 class="text-sm font-inter font-semibold text-gray-900 mb-2 uppercase tracking-wide">Afternoon</h4>
                    <div class="text-base sm:text-lg font-inter text-gray-700 leading-relaxed prose max-w-none">
                      <Fragment set:html={row.afternoon} />
                    </div>
                  </div>
                )}
                
                {!isReducedColumns && row.evening && (
                  <div class="p-4">
                    <h4 class="text-sm font-inter font-semibold text-gray-900 mb-2 uppercase tracking-wide">Evening</h4>
                    <div class="text-base sm:text-lg font-inter text-gray-700 leading-relaxed prose max-w-none">
                      <Fragment set:html={row.evening} />
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        ))}
      </div>
      
      <!-- Desktop: Table Layout -->
      <div class="hidden lg:block overflow-x-auto rounded-2xl border-2 border-gray-200 shadow-lg">
        <table class="w-full">
          <thead>
            <tr class="bg-[#0D1C4E]">
              <th class="text-left px-6 py-4 text-white font-inter font-semibold text-base sm:text-lg border-r border-white/20">
                {isClinicPage ? 'Timings' : (isJuniorCamp ? 'Day' : 'Days')}
              </th>
              <th class={`text-left px-6 py-4 text-white font-inter font-semibold text-base sm:text-lg ${!isReducedColumns ? 'border-r border-white/20' : ''}`}>
                {isClinicPage ? 'Content' : (isJuniorCamp ? 'Schedule' : 'Morning')}
              </th>
              {!isReducedColumns && (
              <th class="text-left px-6 py-4 text-white font-inter font-semibold text-base sm:text-lg border-r border-white/20">
                Afternoon
              </th>
              )}
              {!isReducedColumns && (
              <th class="text-left px-6 py-4 text-white font-inter font-semibold text-base sm:text-lg">
                Evening
              </th>
              )}
            </tr>
          </thead>
          <tbody>
            {scheduleData.scheduleRows.map((row, index) => (
              <tr class={`${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} border-b border-gray-200 last:border-b-0`}>
                <td class="px-6 py-5 text-gray-900 font-inter font-semibold text-base sm:text-lg border-r border-gray-200 align-top">
                  {row.day}
                </td>
                <td class={`px-6 py-5 text-gray-700 font-inter text-base sm:text-lg leading-relaxed ${!isReducedColumns ? 'border-r border-gray-200' : ''} align-top`}>
                  {row.morning ? (
                    <div class="prose max-w-none">
                      <Fragment set:html={row.morning} />
                    </div>
                  ) : (
                    <span class="text-gray-400">—</span>
                  )}
                </td>
                {!isReducedColumns && (
                <td class="px-6 py-5 text-gray-700 font-inter text-base sm:text-lg leading-relaxed border-r border-gray-200 align-top">
                  {row.afternoon ? (
                    <div class="prose max-w-none">
                      <Fragment set:html={row.afternoon} />
                    </div>
                  ) : (
                    <span class="text-gray-400">—</span>
                  )}
                </td>
                )}
                {!isReducedColumns && (
                <td class="px-6 py-5 text-gray-700 font-inter text-base sm:text-lg leading-relaxed align-top">
                  {row.evening ? (
                    <div class="prose max-w-none">
                      <Fragment set:html={row.evening} />
                    </div>
                  ) : (
                    <span class="text-gray-400">—</span>
                  )}
                </td>
                )}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>
)}

<style>
  .font-inter {
    font-family: 'Inter', sans-serif;
  }
  
  .font-playfair {
    font-family: 'Playfair Display', serif;
  }
  
  /* Prose styling for schedule content */
  .prose p {
    margin: 0 0 0.5rem 0;
  }
  
  .prose p:last-child {
    margin-bottom: 0;
  }
  
  .prose ul,
  .prose ol {
    margin: 0;
    padding-left: 1.25rem;
  }
  
  .prose li {
    margin: 0.25rem 0;
  }
  
  .prose strong {
    font-weight: 600;
    color: rgb(17 24 39);
  }
  
  /* Ensure table doesn't overflow */
  table {
    border-collapse: collapse;
    width: 100%;
  }
  
  /* Mobile accordion animations */
  .schedule-accordion-item.active .schedule-accordion-content {
    max-height: 2000px;
  }
  
  .schedule-accordion-item.active .schedule-chevron {
    transform: rotate(180deg);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const accordionButtons = document.querySelectorAll('.schedule-accordion-btn');
    
    // Open first accordion by default on mobile
    const firstItem = document.querySelector('.schedule-accordion-item');
    if (firstItem && window.innerWidth < 1024) {
      firstItem.classList.add('active');
    }
    
    accordionButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const item = button.closest('.schedule-accordion-item');
        const isActive = item.classList.contains('active');
        
        // Toggle current item
        if (isActive) {
          item.classList.remove('active');
        } else {
          item.classList.add('active');
        }
      });
    });
  });
</script>


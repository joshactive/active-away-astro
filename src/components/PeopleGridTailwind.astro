---
// People Grid section component - Tailwind CSS Version
import { getStrapiImageAttrs } from '../utils/cloudflareImages.js';
import { getPeople } from '../utils/strapi.js';

// Fetch people from Strapi
let people = [];
try {
  people = await getPeople();
  console.log(`ðŸ‘¥ Fetched ${people.length} team members`);
} catch (error) {
  console.error('Error fetching people:', error);
}

const hasPeople = people && people.length > 0;
---

{hasPeople && (
  <section class="w-full bg-gray-50 py-12 sm:py-16 lg:py-24">
    <div class="container mx-auto max-w-[1400px] px-4 sm:px-10">
      
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-playfair font-semibold text-gray-900 mb-8 sm:mb-12 text-center">
        Meet Our Team
      </h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 sm:gap-8">
        {people.map((person) => {
          let personImageAttrs = null;
          
          if (person.image) {
            const imageUrl = person.image.url || person.image;
            const imageAlt = person.image.alt || person.image.alternativeText || person.name;
            
            if (typeof imageUrl === 'string') {
              personImageAttrs = getStrapiImageAttrs(
                { url: imageUrl, alt: imageAlt },
                {
                  displayWidth: 400,
                  displayHeight: 400,
                  fit: 'cover',
                  sizes: '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 400px',
                  quality: 80
                }
              );
              
              if (!personImageAttrs) {
                personImageAttrs = {
                  src: imageUrl,
                  url: imageUrl,
                  alt: imageAlt,
                  loading: 'lazy'
                };
              }
            }
          }
          
          return (
            <div class="bg-white border-2 border-gray-200 rounded-2xl overflow-hidden hover:shadow-lg hover:-translate-y-1 transition-all duration-300">
              {/* Person Image */}
              {personImageAttrs && (
                <div class="aspect-square overflow-hidden bg-gray-100">
                  <img 
                    src={personImageAttrs.src || personImageAttrs.url}
                    {...(personImageAttrs.srcset && { srcset: personImageAttrs.srcset })}
                    {...(personImageAttrs.sizes && { sizes: personImageAttrs.sizes })}
                    alt={personImageAttrs.alt}
                    width={personImageAttrs.width || 400}
                    height={personImageAttrs.height || 400}
                    class="w-full h-full object-cover"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
              )}
              
              {/* Person Info */}
              <div class="p-5 sm:p-6">
                {/* Name - Link if website exists */}
                {person.website ? (
                  <a 
                    href={person.website}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-lg sm:text-xl font-playfair font-semibold text-gray-900 hover:text-[#ad986c] transition-colors mb-1 inline-block"
                  >
                    {person.name}
                  </a>
                ) : (
                  <h3 class="text-lg sm:text-xl font-playfair font-semibold text-gray-900 mb-1">
                    {person.name}
                  </h3>
                )}
                
                {person.role && (
                  <p class="text-sm sm:text-base font-inter font-medium text-[#ad986c] mb-3">
                    {person.role}
                  </p>
                )}
                
                {person.bio && (
                  <div>
                    <div 
                      class="person-bio text-sm font-inter text-gray-700 leading-relaxed line-clamp-3"
                      data-person-id={person.id}
                    >
                      <Fragment set:html={person.bio} />
                    </div>
                    <button 
                      class="read-more-btn mt-2 text-sm font-inter font-semibold text-[#ad986c] hover:text-[#8a7454] transition-colors hidden"
                      data-person-id={person.id}
                      type="button"
                    >
                      Read more
                    </button>
                  </div>
                )}
                
                {/* Social Links */}
                {(person.linkedin || person.email || person.website) && (
                  <div class="flex gap-3 mt-4 justify-center">
                    {person.linkedin && (
                      <a 
                        href={person.linkedin}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-gray-600 hover:text-[#ad986c] transition-colors"
                        aria-label={`${person.name} LinkedIn`}
                      >
                        <svg class="w-5 h-5" viewBox="0 0 448 512" fill="currentColor">
                          <path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/>
                        </svg>
                      </a>
                    )}
                    {person.website && (
                      <a 
                        href={person.website}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-gray-600 hover:text-[#ad986c] transition-colors"
                        aria-label={`${person.name} Website`}
                      >
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                        </svg>
                      </a>
                    )}
                    {person.email && (
                      <a 
                        href={`mailto:${person.email}`}
                        class="text-gray-600 hover:text-[#ad986c] transition-colors"
                        aria-label={`Email ${person.name}`}
                      >
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                      </a>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </section>
)}

<style>
  .font-inter {
    font-family: 'Inter', sans-serif;
  }
  
  .font-playfair {
    font-family: 'Playfair Display', serif;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const readMoreButtons = document.querySelectorAll('.read-more-btn');
    
    // Check if bio is truncated and show button
    function checkTruncation() {
      readMoreButtons.forEach(button => {
        const personId = button.getAttribute('data-person-id');
        const bio = document.querySelector(`.person-bio[data-person-id="${personId}"]`);
        
        if (bio) {
          const isTruncated = bio.scrollHeight > bio.clientHeight;
          if (isTruncated) {
            button.classList.remove('hidden');
          } else {
            button.classList.add('hidden');
          }
        }
      });
    }
    
    // Check on load
    checkTruncation();
    
    // Check on resize
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(checkTruncation, 250);
    });
    
    // Handle click to expand/collapse
    readMoreButtons.forEach(button => {
      button.addEventListener('click', () => {
        const personId = button.getAttribute('data-person-id');
        const bio = document.querySelector(`.person-bio[data-person-id="${personId}"]`);
        
        if (bio.classList.contains('line-clamp-3')) {
          bio.classList.remove('line-clamp-3');
          button.textContent = 'Read less';
        } else {
          bio.classList.add('line-clamp-3');
          button.textContent = 'Read more';
        }
      });
    });
  });
</script>


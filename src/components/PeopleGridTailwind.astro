---
// People Grid section component - Tailwind CSS Version
import { getStrapiImageAttrs } from '../utils/cloudflareImages.js';
import { getPeople } from '../utils/strapi.js';

// Fetch people from Strapi
let people = [];
try {
  people = await getPeople();
  console.log(`ðŸ‘¥ Fetched ${people.length} team members`);
} catch (error) {
  console.error('Error fetching people:', error);
}

const hasPeople = people && people.length > 0;
---

{hasPeople && (
  <section class="w-full bg-white py-12 sm:py-16 lg:py-24">
    <div class="container mx-auto max-w-[1400px] px-4 sm:px-10">
      
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-playfair font-semibold text-gray-900 mb-8 sm:mb-12 text-center">
        Meet Our Team
      </h2>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 sm:gap-8">
        {people.map((person) => {
          let personImageAttrs = null;
          
          if (person.image) {
            const imageUrl = person.image.url || person.image;
            const imageAlt = person.image.alt || person.image.alternativeText || person.name;
            
            if (typeof imageUrl === 'string') {
              personImageAttrs = getStrapiImageAttrs(
                { url: imageUrl, alt: imageAlt },
                {
                  displayWidth: 400,
                  displayHeight: 400,
                  fit: 'cover',
                  sizes: '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 400px',
                  quality: 80
                }
              );
              
              if (!personImageAttrs) {
                personImageAttrs = {
                  src: imageUrl,
                  url: imageUrl,
                  alt: imageAlt,
                  loading: 'lazy'
                };
              }
            }
          }
          
          return (
            <div class="bg-white border-2 border-gray-200 rounded-2xl overflow-hidden hover:shadow-lg hover:-translate-y-1 transition-all duration-300">
              {/* Person Image */}
              {personImageAttrs && (
                <div class="aspect-square overflow-hidden bg-gray-100">
                  <img 
                    src={personImageAttrs.src || personImageAttrs.url}
                    {...(personImageAttrs.srcset && { srcset: personImageAttrs.srcset })}
                    {...(personImageAttrs.sizes && { sizes: personImageAttrs.sizes })}
                    alt={personImageAttrs.alt}
                    width={personImageAttrs.width || 400}
                    height={personImageAttrs.height || 400}
                    class="w-full h-full object-cover"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
              )}
              
              {/* Person Info */}
              <div class="p-5 sm:p-6">
                <h3 class="text-lg sm:text-xl font-playfair font-semibold text-gray-900 mb-1">
                  {person.name}
                </h3>
                
                {person.role && (
                  <p class="text-sm sm:text-base font-inter font-medium text-[#ad986c] mb-3">
                    {person.role}
                  </p>
                )}
                
                {person.bio && (
                  <div class="text-sm font-inter text-gray-700 leading-relaxed line-clamp-3">
                    <Fragment set:html={person.bio} />
                  </div>
                )}
                
                {/* Social Links */}
                {(person.linkedin || person.email) && (
                  <div class="flex gap-3 mt-4">
                    {person.linkedin && (
                      <a 
                        href={person.linkedin}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-gray-600 hover:text-[#ad986c] transition-colors"
                        aria-label={`${person.name} LinkedIn`}
                      >
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M16.338 16.338H13.67V12.16c0-.995-.017-2.277-1.387-2.277-1.39 0-1.601 1.086-1.601 2.207v4.248H8.014v-8.59h2.559v1.174h.037c.356-.675 1.227-1.387 2.526-1.387 2.703 0 3.203 1.778 3.203 4.092v4.711zM5.005 6.575a1.548 1.548 0 11-.003-3.096 1.548 1.548 0 01.003 3.096zm-1.337 9.763H6.34v-8.59H3.667v8.59zM17.668 1H2.328C1.595 1 1 1.581 1 2.298v15.403C1 18.418 1.595 19 2.328 19h15.34c.734 0 1.332-.582 1.332-1.299V2.298C19 1.581 18.402 1 17.668 1z"/>
                        </svg>
                      </a>
                    )}
                    {person.email && (
                      <a 
                        href={`mailto:${person.email}`}
                        class="text-gray-600 hover:text-[#ad986c] transition-colors"
                        aria-label={`Email ${person.name}`}
                      >
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                      </a>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </section>
)}

<style>
  .font-inter {
    font-family: 'Inter', sans-serif;
  }
  
  .font-playfair {
    font-family: 'Playfair Display', serif;
  }
</style>


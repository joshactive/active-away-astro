---
// Hero section component for Active Away - Figma Perfect Match
import { getImageByName, generateSrcSet } from '../utils/cloudflareImages.js';
import { getHomePage, getStrapiImageData, extractCloudflareImageId } from '../utils/strapi.js';
import { Button } from '../components/ui/button';
import { MobileMenuButton, CloseButton, SearchIcon, StarIcon, ChevronDownIcon } from '../components/ui/MobileMenuButton';

// Fetch home page data from Strapi
let homeData = null;
try {
  homeData = await getHomePage();
  console.log('üè† Home Data received:', !!homeData);
  console.log('üñºÔ∏è  Has header_image:', !!homeData?.header_image);
} catch (error) {
  console.warn('Could not fetch home page data from Strapi, using defaults:', error);
}

// Extract heading and subheading with fallbacks
const mainHeading = homeData?.main_heading || 'Exceptional Tennis, Padel & Pickleball Holidays';
const mainSubHeading = homeData?.main_sub_heading || 'Unique Racket Experiences that unite like-minded individuals, through impeccable service delivered by truly knowledgeable hosts in excellent locations.';

// ==========================================
// Hero Background Image - Dynamic from Strapi
// ==========================================
// Design dimensions: 16:9 aspect ratio for hero background
const HERO_DESIGN_WIDTH = 1920;
const HERO_DESIGN_HEIGHT = 1080;

let heroBgUrl, heroBgAlt, heroBgSrcSet;

// Check if Strapi has a header_image
if (homeData?.header_image) {
  const strapiHeroBg = getStrapiImageData(homeData.header_image);
  
  if (strapiHeroBg.url) {
    // Use Strapi image URL and alt text
    heroBgUrl = strapiHeroBg.url;
    heroBgAlt = strapiHeroBg.alt || 'Hero background';
    
    // Use Strapi's pre-generated responsive formats if available
    if (strapiHeroBg.formats) {
      const formats = strapiHeroBg.formats;
      const srcsetParts = [];
      
      // Build srcset from Strapi's formats (small, medium, large)
      if (formats.small) {
        srcsetParts.push(`${formats.small.url} ${formats.small.width}w`);
      }
      if (formats.medium) {
        srcsetParts.push(`${formats.medium.url} ${formats.medium.width}w`);
      }
      if (formats.large) {
        srcsetParts.push(`${formats.large.url} ${formats.large.width}w`);
      }
      // Add the original/public variant
      if (strapiHeroBg.width) {
        srcsetParts.push(`${strapiHeroBg.url} ${strapiHeroBg.width}w`);
      }
      
      heroBgSrcSet = srcsetParts.length > 0 ? srcsetParts.join(', ') : undefined;
      console.log('‚úÖ Using Strapi image with', srcsetParts.length, 'variants');
    } else {
      // No formats, just use the main image
      heroBgSrcSet = undefined;
      console.log('‚úÖ Using Strapi image (no responsive variants)');
    }
  } else {
    console.log('‚ö†Ô∏è  header_image exists but no URL');
  }
} else {
  console.log('‚ÑπÔ∏è  No header_image field found');
}

// Fallback to hardcoded image
if (!heroBgUrl) {
  heroBgUrl = getImageByName('hero-bg', { size: 'public' });
  heroBgAlt = 'Active Away - Tennis, Padel & Pickleball Holidays';
  heroBgSrcSet = generateSrcSet('03bade93-3cf6-49b0-047f-a9eb556aa200', [
    { size: '480x270', width: 480 },
    { size: '768x432', width: 768 },
    { size: '1200x675', width: 1200 },
    { size: '1920x1080', width: 1920 }
  ]);
  
  console.log('‚ÑπÔ∏è  Using fallback hero background');
}

// ==========================================
// Other Images
// ==========================================
const logoUrl = 'https://activeaway.com/cdn-cgi/imagedelivery/-aT8Z2F9gGvZ9fdofZcCaQ/4a4fae2f-b29c-4e69-5a9e-acf953fd3c00/public';

// Man images URLs
const man1Url = getImageByName('man-1', { size: 'public' });
const man2Url = getImageByName('man-2', { size: 'public' });
const man3Url = getImageByName('man-3', { size: 'public' });
const man4Url = getImageByName('man-4', { size: 'public' });

// Debug: Confirm setup
console.log('üéØ Hero Background:', heroBgUrl ? 'Ready' : 'Missing');
console.log('üìê Design Dimensions:', `${HERO_DESIGN_WIDTH}x${HERO_DESIGN_HEIGHT}`);
---

<script is:inline>
  // Better error handling for images
  function handleImageError(img, fallbackSrc) {
    if (img.src !== fallbackSrc) {
      img.src = fallbackSrc;
    }
  }

  // Mobile menu toggle
  function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('mobile-overlay');
    if (menu && overlay) {
      menu.classList.toggle('translate-x-full');
      overlay.classList.toggle('hidden');
    }
  }

  function closeMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('mobile-overlay');
    if (menu && overlay) {
      menu.classList.add('translate-x-full');
      overlay.classList.add('hidden');
    }
  }
</script>

<section class="relative w-full h-screen flex flex-col items-start p-0 overflow-x-hidden py-6 sm:py-10">
  <!-- Background Image -->
  <div class="absolute inset-0 w-full h-full">
    <img 
      src={heroBgUrl}
      {...(heroBgSrcSet && { srcset: heroBgSrcSet, sizes: "100vw" })}
      alt={heroBgAlt}
      width={HERO_DESIGN_WIDTH}
      height={HERO_DESIGN_HEIGHT}
      class="w-full h-full object-cover"
      loading="eager"
      fetchpriority="high"
    />
    <div class="absolute inset-0 bg-gradient-to-b from-black/35 to-black/35"></div>
  </div>

  <!-- Navigation Bar -->
  <nav class="absolute w-full top-0 z-20 py-4">
    <div class="w-full px-4 lg:px-12">
      <div class="flex justify-between items-center h-14">
              <!-- Logo -->
              <div class="w-[178px] h-10 sm:w-36 sm:h-12 lg:w-40 lg:h-14">
          <img 
            src={logoUrl} 
            alt="Active Away Logo" 
            width="200"
            height="56"
            class="w-full h-full object-contain" 
            loading="eager"
          />
        </div>

        <!-- Center Navigation - Desktop Only -->
        <div class="hidden lg:flex absolute left-1/2 transform -translate-x-1/2 h-14" style="width: 40rem;">
          <div class="flex flex-row justify-center items-center px-2 w-full h-full bg-white/10 backdrop-blur-md border border-white/20 rounded-full gap-1">
            <a href="#home" class="flex flex-row justify-center items-center px-6 py-2.5 gap-1 h-11 rounded-full font-inter text-sm leading-6 transition-all duration-300 cursor-pointer bg-white/30 backdrop-blur-md border border-white/30 text-white font-medium shadow-lg">Home</a>
            <a href="#dates" class="flex flex-row justify-center items-center px-6 py-2.5 gap-1 h-11 rounded-full font-inter text-sm leading-6 text-white transition-all duration-300 cursor-pointer font-normal hover:bg-white/10">Dates</a>
            <a href="#rackets" class="flex flex-row justify-center items-center px-6 py-2.5 gap-1 h-11 rounded-full font-inter text-sm leading-6 text-white transition-all duration-300 cursor-pointer font-normal hover:bg-white/10">Rackets</a>
            <a href="#about" class="flex flex-row justify-center items-center px-6 py-2.5 gap-1 h-11 rounded-full font-inter text-sm leading-6 text-white transition-all duration-300 cursor-pointer font-normal hover:bg-white/10">About Us</a>
            <a href="#destinations" class="flex flex-row justify-center items-center px-6 py-2.5 gap-1 h-11 rounded-full font-inter text-sm leading-6 text-white transition-all duration-300 cursor-pointer font-normal hover:bg-white/10">Destinations</a>
            <a href="#blogs" class="flex flex-row justify-center items-center px-6 py-2.5 gap-1 h-11 rounded-full font-inter text-sm leading-6 text-white transition-all duration-300 cursor-pointer font-normal hover:bg-white/10">Blog</a>
          </div>
        </div>

        <!-- Right CTA Buttons - Desktop Only -->
        <div class="hidden lg:flex flex-row justify-end items-center p-0 gap-3 w-80 h-14">
          <button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-sm font-medium transition-all focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 bg-white/30 backdrop-blur-md border border-white/30 text-white hover:bg-white/40 px-6 py-3 h-14 shadow-lg">
            Login
          </button>
          <button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-sm font-medium transition-all focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 bg-gold backdrop-blur-md text-white hover:bg-gold-700 px-6 py-3 h-14">
            Book Now
          </button>
        </div>

        <!-- Mobile Menu Button -->
        <div class="lg:hidden">
          <MobileMenuButton client:load onClick={() => {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('mobile-overlay');
            if (menu && overlay) {
              menu.classList.toggle('translate-x-full');
              overlay.classList.toggle('hidden');
            }
          }} />
        </div>
      </div>
    </div>
  </nav>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-overlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="closeMobileMenu()"></div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="fixed top-0 right-0 h-full w-80 bg-white z-50 transform translate-x-full transition-transform duration-300 ease-in-out shadow-xl">
    <div class="flex flex-col h-full">
      <!-- Close Button -->
      <div class="flex justify-between items-center p-4 border-b">
        <span class="text-lg font-semibold text-gray-800">Menu</span>
        <CloseButton client:load onClick={() => {
          const menu = document.getElementById('mobile-menu');
          const overlay = document.getElementById('mobile-overlay');
          if (menu && overlay) {
            menu.classList.add('translate-x-full');
            overlay.classList.add('hidden');
          }
        }} />
      </div>

      <!-- Menu Items -->
      <div class="flex-1 overflow-y-auto py-4">
        <div class="flex flex-col gap-2 px-4">
          <a href="#home" onclick="closeMobileMenu()" class="py-3 px-4 rounded-lg text-gray-800 hover:bg-gold/20 hover:text-gold-700 font-medium text-sm sm:text-base transition-colors">Home</a>
          <a href="#dates" onclick="closeMobileMenu()" class="py-3 px-4 rounded-lg text-gray-800 hover:bg-gold/20 hover:text-gold-700 font-medium text-sm sm:text-base transition-colors">Dates</a>
          <a href="#rackets" onclick="closeMobileMenu()" class="py-3 px-4 rounded-lg text-gray-800 hover:bg-gold/20 hover:text-gold-700 font-medium text-sm sm:text-base transition-colors">Rackets</a>
          <a href="#about" onclick="closeMobileMenu()" class="py-3 px-4 rounded-lg text-gray-800 hover:bg-gold/20 hover:text-gold-700 font-medium text-sm sm:text-base transition-colors">About Us</a>
          <a href="#destinations" onclick="closeMobileMenu()" class="py-3 px-4 rounded-lg text-gray-800 hover:bg-gold/20 hover:text-gold-700 font-medium text-sm sm:text-base transition-colors">Destinations</a>
          <a href="#blogs" onclick="closeMobileMenu()" class="py-3 px-4 rounded-lg text-gray-800 hover:bg-gold/20 hover:text-gold-700 font-medium text-sm sm:text-base transition-colors">Blogs</a>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="border-t p-4 space-y-3">
        <button class="w-full inline-flex items-center justify-center rounded-md border border-gray-300 bg-white text-gray-800 hover:bg-gray-50 text-sm sm:text-base px-4 py-2 transition-colors" onclick="closeMobileMenu()">
          Login
        </button>
          <button class="w-full inline-flex items-center justify-center rounded-md bg-gray-800 text-white hover:bg-gold text-sm sm:text-base px-4 py-2 transition-colors" onclick="closeMobileMenu()">
            Book Now
          </button>
      </div>
    </div>
  </div>

  <!-- Main Hero Content -->
  <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full z-10 flex justify-center items-center">
    <div class="container mx-auto px-4 lg:px-8">
      <div class="w-full flex flex-col items-center justify-center gap-6 sm:gap-8 lg:gap-10 text-center">
        <!-- Headline Section -->
        <div class="flex flex-col items-center justify-center text-center w-full max-w-4xl gap-3 sm:gap-4 md:gap-5">
          <h1 class="w-full font-playfair font-bold text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl leading-tight lg:leading-[1.3] text-center text-white m-0 break-words" style="line-height: 1.3 !important; hyphens: none; -webkit-hyphens: none; -ms-hyphens: none;">
            {mainHeading}
          </h1>
          <p class="w-full font-inter font-normal text-base sm:text-lg md:text-xl lg:text-xl leading-relaxed text-center text-white m-0 max-w-2xl break-words">
            {mainSubHeading}
          </p>
        </div>

        <!-- Search Section -->
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 w-full max-w-2xl sm:max-w-3xl lg:max-w-4xl px-4 sm:px-0">
          <div class="flex flex-col sm:flex-row items-center w-full bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl sm:rounded-full px-3 sm:px-4 md:px-6 py-3 sm:py-3 md:py-4 gap-2 sm:gap-0">
            <!-- Mobile: 2x2 Grid for dropdowns -->
            <div class="grid grid-cols-2 gap-2 w-full sm:hidden">
              <!-- Product Section -->
              <div class="flex flex-row items-center relative">
                <select class="w-full h-11 font-inter font-normal text-xs leading-7 flex items-center text-white bg-white/10 border border-white/30 outline-none appearance-none pr-7 cursor-pointer px-3 rounded-lg backdrop-blur-sm">
                  <option value="" class="text-gray-800 bg-white px-4">Product</option>
                  <option value="tennis" class="text-gray-800 bg-white px-4">Tennis</option>
                  <option value="padel" class="text-gray-800 bg-white px-4">Padel</option>
                  <option value="pickleball" class="text-gray-800 bg-white px-4">Pickleball</option>
                </select>
                <ChevronDownIcon client:load className="absolute right-2.5 w-4 h-4 text-white pointer-events-none" />
              </div>
              
              <!-- Location Section -->
              <div class="flex flex-row items-center relative">
                <select class="w-full h-11 font-inter font-normal text-xs leading-7 flex items-center text-white bg-white/10 border border-white/30 outline-none appearance-none pr-7 cursor-pointer px-3 rounded-lg backdrop-blur-sm">
                  <option value="" class="text-gray-800 bg-white px-4">Location</option>
                  <option value="spain" class="text-gray-800 bg-white px-4">Spain</option>
                  <option value="portugal" class="text-gray-800 bg-white px-4">Portugal</option>
                  <option value="italy" class="text-gray-800 bg-white px-4">Italy</option>
                  <option value="greece" class="text-gray-800 bg-white px-4">Greece</option>
                </select>
                <ChevronDownIcon client:load className="absolute right-2.5 w-4 h-4 text-white pointer-events-none" />
              </div>
              
              <!-- Month Section -->
              <div class="flex flex-row items-center relative">
                <select class="w-full h-11 font-inter font-normal text-xs leading-7 flex items-center text-white bg-white/10 border border-white/30 outline-none appearance-none pr-7 cursor-pointer px-3 rounded-lg backdrop-blur-sm">
                  <option value="" class="text-gray-800 bg-white px-4">Month</option>
                  <option value="january" class="text-gray-800 bg-white px-4">January</option>
                  <option value="february" class="text-gray-800 bg-white px-4">February</option>
                  <option value="march" class="text-gray-800 bg-white px-4">March</option>
                  <option value="april" class="text-gray-800 bg-white px-4">April</option>
                  <option value="may" class="text-gray-800 bg-white px-4">May</option>
                  <option value="june" class="text-gray-800 bg-white px-4">June</option>
                  <option value="july" class="text-gray-800 bg-white px-4">July</option>
                  <option value="august" class="text-gray-800 bg-white px-4">August</option>
                  <option value="september" class="text-gray-800 bg-white px-4">September</option>
                  <option value="october" class="text-gray-800 bg-white px-4">October</option>
                  <option value="november" class="text-gray-800 bg-white px-4">November</option>
                  <option value="december" class="text-gray-800 bg-white px-4">December</option>
                </select>
                <ChevronDownIcon client:load className="absolute right-2.5 w-4 h-4 text-white pointer-events-none" />
              </div>
              
              <!-- Search Button (mobile) -->
              <button class="inline-flex items-center justify-center bg-white/30 backdrop-blur-md border border-white/30 hover:bg-white/40 active:bg-white/50 rounded-lg px-4 py-2.5 h-11 text-white text-sm transition-all shadow-lg font-medium">
                <SearchIcon client:load className="w-4 h-4 mr-1.5" />
                Search
              </button>
            </div>

            <!-- Desktop: Horizontal layout (unchanged) -->
            <!-- Product Section -->
            <div class="hidden sm:flex flex-row items-center flex-1 min-w-0 relative">
              <select class="w-full h-8 md:h-10 font-inter font-normal text-sm md:text-base lg:text-lg leading-7 flex items-center text-white bg-transparent outline-none appearance-none pr-8 cursor-pointer px-4">
                <option value="" class="text-gray-800 bg-white px-4">Select Product</option>
                <option value="tennis" class="text-gray-800 bg-white px-4">Tennis</option>
                <option value="padel" class="text-gray-800 bg-white px-4">Padel</option>
                <option value="pickleball" class="text-gray-800 bg-white px-4">Pickleball</option>
              </select>
              <ChevronDownIcon client:load className="absolute right-2 w-4 h-4 text-white pointer-events-none" />
            </div>
            
            <div class="hidden sm:block w-px h-10 bg-white/30 mx-4"></div>
            
            <!-- Location Section -->
            <div class="hidden sm:flex flex-row items-center flex-1 min-w-0 relative">
              <select class="w-full h-8 md:h-10 font-inter font-normal text-sm md:text-base lg:text-lg leading-7 flex items-center text-white bg-transparent outline-none appearance-none pr-8 cursor-pointer px-4">
                <option value="" class="text-gray-800 bg-white px-4">Select Location</option>
                <option value="spain" class="text-gray-800 bg-white px-4">Spain</option>
                <option value="portugal" class="text-gray-800 bg-white px-4">Portugal</option>
                <option value="italy" class="text-gray-800 bg-white px-4">Italy</option>
                <option value="greece" class="text-gray-800 bg-white px-4">Greece</option>
              </select>
              <ChevronDownIcon client:load className="absolute right-2 w-4 h-4 text-white pointer-events-none" />
            </div>
            
            <div class="hidden sm:block w-px h-10 bg-white/30 mx-4"></div>
            
            <!-- Month Section -->
            <div class="hidden sm:flex flex-row items-center flex-1 min-w-0 relative">
              <select class="w-full h-8 md:h-10 font-inter font-normal text-sm md:text-base lg:text-lg leading-7 flex items-center text-white bg-transparent outline-none appearance-none pr-8 cursor-pointer px-4">
                <option value="" class="text-gray-800 bg-white px-4">Select Month</option>
                <option value="january" class="text-gray-800 bg-white px-4">January</option>
                <option value="february" class="text-gray-800 bg-white px-4">February</option>
                <option value="march" class="text-gray-800 bg-white px-4">March</option>
                <option value="april" class="text-gray-800 bg-white px-4">April</option>
                <option value="may" class="text-gray-800 bg-white px-4">May</option>
                <option value="june" class="text-gray-800 bg-white px-4">June</option>
                <option value="july" class="text-gray-800 bg-white px-4">July</option>
                <option value="august" class="text-gray-800 bg-white px-4">August</option>
                <option value="september" class="text-gray-800 bg-white px-4">September</option>
                <option value="october" class="text-gray-800 bg-white px-4">October</option>
                <option value="november" class="text-gray-800 bg-white px-4">November</option>
                <option value="december" class="text-gray-800 bg-white px-4">December</option>
              </select>
              <ChevronDownIcon client:load className="absolute right-2 w-4 h-4 text-white pointer-events-none" />
            </div>
            
            <div class="hidden sm:block w-px h-10 bg-white/30 mx-4"></div>
            
            <!-- Search Button (desktop) -->
            <button class="hidden sm:inline-flex items-center justify-center bg-white/30 backdrop-blur-md border border-white/30 hover:bg-white/40 rounded-full px-5 md:px-6 py-2.5 md:py-3 h-8 md:h-10 text-white text-sm md:text-base transition-all shadow-lg font-medium">
              <SearchIcon client:load className="w-3 h-3 md:w-4 md:h-4 mr-2" />
              Search
            </button>
          </div>
        </div>

        <!-- Reviews Section -->
        <div class="flex flex-col items-center justify-center gap-3 mt-2">
          <div class="flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-3">
            <div class="flex items-center gap-3 sm:gap-6">
              <div class="flex -space-x-2 sm:-space-x-3">
                <img src={man1Url} alt="Reviewer 1" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-full border-2 border-white object-cover" onerror="handleImageError(this, '/images/hero/man-1.jpg')" />
                <img src={man2Url} alt="Reviewer 2" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-full border-2 border-white object-cover" onerror="handleImageError(this, '/images/hero/man-2.jpg')" />
                <img src={man3Url} alt="Reviewer 3" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-full border-2 border-white object-cover" onerror="handleImageError(this, '/images/hero/man-3.jpg')" />
                <img src={man4Url} alt="Reviewer 4" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-full border-2 border-white object-cover" onerror="handleImageError(this, '/images/hero/man-4.jpg')" />
              </div>
              <div class="flex items-center gap-2 sm:gap-3">
                <span class="font-inter font-semibold text-white text-xl sm:text-2xl md:text-3xl lg:text-4xl leading-none">5/5</span>
                <StarIcon client:load className="text-white w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7" />
              </div>
            </div>
            <div class="text-center">
              <p class="text-sm sm:text-base md:text-lg font-inter text-white/90">
                from <span class="font-semibold">thousands of online reviews</span>
              </p>
            </div>
          </div>
          
          <!-- Trustpilot Widget -->
          <div class="w-full max-w-md px-4">
            <div class="trustpilot-widget" data-locale="en-GB" data-template-id="5419b6a8b0d04a076446a9ad" data-businessunit-id="5fdb351da3a2b60001ac34ba" data-style-height="24px" data-style-width="100%" data-theme="dark" data-token="ca9d8ad1-cc16-49ab-a0e8-b1baa3dd973b" data-min-review-count="0" data-style-alignment="center">
              <a href="https://uk.trustpilot.com/review/activeaway.com" target="_blank" rel="noopener">Trustpilot</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap');
  
  .font-inter {
    font-family: 'Inter', sans-serif;
  }
  
  .font-playfair {
    font-family: 'Playfair Display', serif;
  }
</style>